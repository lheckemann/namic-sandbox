import os
import sys
import string

import datetime


segExe = "src/r/SFLSRobustStat3DTestProbMap"

if len(sys.argv) < 3:
    print "args: targetT2Image atlasImage(probability map generated by atlasBasedSeg.py)"
    sys.exit(-1)


targetT2Image = sys.argv[1]
atlasImage = sys.argv[2]


# generate results dir
now = datetime.datetime.now()
rsltDirPrefix = os.path.basename(targetT2Image)
rsltDirPrefix = rsltDirPrefix.replace(".nrrd", "");
rsltDir = rsltDirPrefix + "-" + str(now.year) + "-" + str(now.month) + "-" + str(now.day) + "-" + str(now.hour)
if os.path.exists(rsltDir):
    rsltDir += ("-" + str(now.minute))
cmd = "mkdir " + rsltDir
os.system(cmd)
#print cmd


for numIter in [100, 500, 900]:
    for curvatureWeight in [0.5, 0.7, 0.9]:
        for homogeniety in [0.5, 0.7, 0.9]:

            outputName = targetT2Image.replace(".nrrd", "-finalSeg");
            outputName = outputName + '-' + str(numIter) + '-' + str(curvatureWeight) + '-' + str(homogeniety) + '.nrrd'
            outputName = os.path.basename(outputName)
            outputName = os.path.join(rsltDir, outputName)
    
            segCmd = " ".join([segExe, targetT2Image, atlasImage, outputName, str(numIter), str(curvatureWeight), str(homogeniety)])
            os.system(segCmd)
