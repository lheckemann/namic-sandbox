PROJECT(OptotrakIGTL)

INCLUDE (CheckIncludeFiles)

IF(CMAKE_SYSTEM_NAME STREQUAL "Darwin")
  ADD_DEFINITIONS(-DPLATFORM_OSX)
  IF(CMAKE_SYSTEM_VERSION MATCHES "9\\.[0-9]*\\.[0-9]*")
    ADD_DEFINITIONS(-DPLATFORM_OSX_LEOPARD)
  ENDIF(CMAKE_SYSTEM_VERSION MATCHES "9\\.[0-9]*\\.[0-9]*")
ENDIF(CMAKE_SYSTEM_NAME STREQUAL "Darwin")

IF(CMAKE_SYSTEM_NAME MATCHES Linux)
ADD_DEFINITIONS(-DPLATFORM_LINUX)
SET(LINUX 1)
SET(CMAKE_C_FLAGS -fPIC)
SET(CMAKE_CXX_FLAGS -fPIC)
ENDIF(CMAKE_SYSTEM_NAME MATCHES Linux)

IF(CMAKE_SYSTEM_NAME STREQUAL "Windows")
ADD_DEFINITIONS(-DPLATFORM_WIN32)
SET(WIN32 1)
ENDIF(CMAKE_SYSTEM_NAME STREQUAL "Windows")


OPTION(USE_OPTOTRAK_WIN "Use Optotrak on Windows" ON)

#### For Optotrak
IF(USE_OPTOTRAK_WIN)
SET (OPTOTRAK_INCLUDE_DIR
C:/NDIoapi/ndlib/include
)
SET (OPTOTRAK_LIB_DIR
C:/NDIoapi/ndlib/msvc
)
SET (OPTOTRAK_LIB
oapi
NDItb
)
SET (OPTOTRAK_SRC
src/ot_aux.cxx
)
ENDIF(USE_OPTOTRAK_WIN)



INCLUDE_DIRECTORIES(
${CMAKE_CURRENT_SOURCE_DIR}/src/
${CMAKE_CURRENT_SOURCE_DIR}/src/igtlutil
libs/
${OPTOTRAK_INCLUDE_DIR}
)

ADD_DEFINITIONS(-DACE_AS_STATIC_LIBS)

OPTION(BUILD_SHARED "Build Shared Libraries" OFF)

LINK_DIRECTORIES(
libs/ace
${OPTOTRAK_LIB_DIR}
)

SET(SOURCES
src/igtlutil/igtl_util.c
src/igtlutil/igtl_header.c
src/igtlutil/igtl_image.c
src/igtlutil/igtl_transform.c
src/igtlutil/crc32.c
src/igtlImageMessage.cxx
src/igtlTransformMessage.cxx
src/igtlMath.cxx
src/igtlMessageBase.cxx
src/igtlObject.cxx
${OPTOTRAK_SRC}
)

SUBDIRS(
libs/ace
)

IF(BUILD_SHARED)
ADD_LIBRARY(OptotrakIGTLLib SHARED
${SOURCES}
)
ELSE(BUILD_SHARED)
ADD_LIBRARY(OptotrakIGTLLib
${SOURCES}
)
ENDIF(BUILD_SHARED)

SET(LIBS
${LIBS}
ACE
)

IF(NOT WIN32)
SET(LIBS
${LIBS}
ncurses
pthread
dl
)
IF(LINUX)
SET(EXTRA_LIBS
rt
)
ENDIF(LINUX)
ENDIF(NOT WIN32)

TARGET_LINK_LIBRARIES(OptotrakIGTLLib
${LIBS}
)

ADD_EXECUTABLE(OptotrakIGTL src/optotrak.cxx)


TARGET_LINK_LIBRARIES(OptotrakIGTL
${EXTRA_LIBS}
OptotrakIGTLLib
${OPTOTRAK_LIB}
)

SET(EXECUTABLE_OUTPUT_PATH
bin
)


