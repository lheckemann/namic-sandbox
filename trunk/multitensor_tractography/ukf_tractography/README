=============== Install Instructions
To build the application you need three third party libraries:
 - gmm++
 - teem
 - blas/LAPACK
You can either install them through your linux' package distribution system
which is the easy, recommended way. In that case you just have to deploy those
packages and build the application with:

  make

If you don' have the rights to install new packages on your system you have to
build all the required libraries. All the required source files are provided
together with this tractography. The only requirement is that you have CMake
installed.
First you have to build teem using CMake:

  tar xzf libs.tar.gz
  cd libs/teem-build
  ccmake ../teem-1.10.0-src
  Type 'c', type 'c' again and then type 'g'
  make

(More information on building teem can be found here:
http://teem.sourceforge.net/build.html)

Once you have built teem you can build the rest with:

  make withlibs

(Note that depending on the system/compiler you'rer using, you might need to
build LAPACK differently (we just assume that you have gcc and therefore GNU's
gfortran). For specific LAPACK building instructions see
http://www.netlib.org/lapack/lawn81/node10.html. The LAPACK source is in
libs/lapack-3.2.2.)

There's a third way and that would mean you also download all the libraries and
build them and install them sytem wide (in /usr/local for example). In this case
we suggest that you use ATLAS (http://math-atlas.sourceforge.net/) to build an
optimized blas library for you system.


=============== Running the Tractography
The only required parameters are the nrrd file containing a DWI data, a nrrd
label file containing the seeds and nrrd label file defining the mask/volume of
the brain (all the other options are optional).
The tractography application is used as follows

./ukf
  --dwi_file FILE                       - DWI data file
  --mask_file                           - File containing the brain mask
  [--seeds_file FILE]                     - File containing the seeds
  [--output_file FILE]                  - Name of the output VTK file 
  [--record_fa (true|false)]            - Store FA in the VTK file?
  [--record_state (true|false)]         - Store the state in the VTK file?
  [--record_cov (true|false)]           - Store the covariance in the VTK file?
  [--model (one-tensor|two-tensor|three-tensor)]    - Use one or two tensor?
  [--tensor_model (full|simple)]        - Use the simple or the full model?
  [--fa_min DOUBLE]
  [--ga_min DOUBLE]
  [--seeds INT]                         - Number of seeds per seed voxel
  [--labels INT(,INT)*]                 - Label number used in the seeds file
  [--Qm DOUBLE]
  [--Ql DOUBLE]
  [--Rs DOUBLE]
  [--theta_max DOUBLE]                  - Max branching angle
  [--store_glyphs (true|false)]         - Stores the tensor main directions.

'theta_max' needs to be at larger than 5 degrees for branching. If 'theta_max'
is set to zero it means that now branching is performed.

There is some example data in folder 'example_data' that you can use to run the
tractography:

  ./ukf --dwi_file example_data/normalized_dwi_data.nhdr \
        --seeds_file example_data/seeds.nhdr \
        --mask_file example_data/brain_mask.nhdr

To perform a full brain tractography you simply don't specify a seeds file. The
tractography will be performed from every voxel in the brain mask where the GA
(generalized anisotropy) is bigger than 0.18. Note that no branching is done in
the full brain tractography, hence the 'theta_max' and 'labels' parameters are
meaningless.

If you chose to store the glyphs, then the tensor main directions will be
written to a separate file as two-point lines. The file is called the same as
the normal output file but is prepended with 'glpyhs_'.
