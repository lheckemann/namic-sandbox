<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
 <head>
  <title>zggsvp.f</title>
 <meta name="generator" content="emacs 21.3.1; htmlfontify 0.20">
<style type="text/css"><!-- 
body { background: rgb(255, 255, 255);  color: rgb(0, 0, 0);  font-style: normal;  font-weight: 500;  font-stretch: normal;  font-family: adobe-courier;  font-size: 11pt;  text-decoration: none; }
span.default   { background: rgb(255, 255, 255);  color: rgb(0, 0, 0);  font-style: normal;  font-weight: 500;  font-stretch: normal;  font-family: adobe-courier;  font-size: 11pt;  text-decoration: none; }
span.default a { background: rgb(255, 255, 255);  color: rgb(0, 0, 0);  font-style: normal;  font-weight: 500;  font-stretch: normal;  font-family: adobe-courier;  font-size: 11pt;  text-decoration: underline; }
span.string   { color: rgb(188, 143, 143);  background: rgb(255, 255, 255);  font-style: normal;  font-weight: 500;  font-stretch: normal;  font-family: adobe-courier;  font-size: 11pt;  text-decoration: none; }
span.string a { color: rgb(188, 143, 143);  background: rgb(255, 255, 255);  font-style: normal;  font-weight: 500;  font-stretch: normal;  font-family: adobe-courier;  font-size: 11pt;  text-decoration: underline; }
span.comment   { color: rgb(178, 34, 34);  background: rgb(255, 255, 255);  font-style: normal;  font-weight: 500;  font-stretch: normal;  font-family: adobe-courier;  font-size: 11pt;  text-decoration: none; }
span.comment a { color: rgb(178, 34, 34);  background: rgb(255, 255, 255);  font-style: normal;  font-weight: 500;  font-stretch: normal;  font-family: adobe-courier;  font-size: 11pt;  text-decoration: underline; }
 --></style>

 </head>
  <body>

<pre>
      SUBROUTINE <a name="ZGGSVP.1"></a><a href="zggsvp.f.html#ZGGSVP.1">ZGGSVP</a>( JOBU, JOBV, JOBQ, M, P, N, A, LDA, B, LDB,
     $                   TOLA, TOLB, K, L, U, LDU, V, LDV, Q, LDQ,
     $                   IWORK, RWORK, TAU, WORK, INFO )
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  -- LAPACK routine (version 3.1) --
</span><span class="comment">*</span><span class="comment">     Univ. of Tennessee, Univ. of California Berkeley and NAG Ltd..
</span><span class="comment">*</span><span class="comment">     November 2006
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     .. Scalar Arguments ..
</span>      CHARACTER          JOBQ, JOBU, JOBV
      INTEGER            INFO, K, L, LDA, LDB, LDQ, LDU, LDV, M, N, P
      DOUBLE PRECISION   TOLA, TOLB
<span class="comment">*</span><span class="comment">     ..
</span><span class="comment">*</span><span class="comment">     .. Array Arguments ..
</span>      INTEGER            IWORK( * )
      DOUBLE PRECISION   RWORK( * )
      COMPLEX*16         A( LDA, * ), B( LDB, * ), Q( LDQ, * ),
     $                   TAU( * ), U( LDU, * ), V( LDV, * ), WORK( * )
<span class="comment">*</span><span class="comment">     ..
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  Purpose
</span><span class="comment">*</span><span class="comment">  =======
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  <a name="ZGGSVP.24"></a><a href="zggsvp.f.html#ZGGSVP.1">ZGGSVP</a> computes unitary matrices U, V and Q such that
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">                   N-K-L  K    L
</span><span class="comment">*</span><span class="comment">   U'*A*Q =     K ( 0    A12  A13 )  if M-K-L &gt;= 0;
</span><span class="comment">*</span><span class="comment">                L ( 0     0   A23 )
</span><span class="comment">*</span><span class="comment">            M-K-L ( 0     0    0  )
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">                   N-K-L  K    L
</span><span class="comment">*</span><span class="comment">          =     K ( 0    A12  A13 )  if M-K-L &lt; 0;
</span><span class="comment">*</span><span class="comment">              M-K ( 0     0   A23 )
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">                 N-K-L  K    L
</span><span class="comment">*</span><span class="comment">   V'*B*Q =   L ( 0     0   B13 )
</span><span class="comment">*</span><span class="comment">            P-L ( 0     0    0  )
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  where the K-by-K matrix A12 and L-by-L matrix B13 are nonsingular
</span><span class="comment">*</span><span class="comment">  upper triangular; A23 is L-by-L upper triangular if M-K-L &gt;= 0,
</span><span class="comment">*</span><span class="comment">  otherwise A23 is (M-K)-by-L upper trapezoidal.  K+L = the effective
</span><span class="comment">*</span><span class="comment">  numerical rank of the (M+P)-by-N matrix (A',B')'.  Z' denotes the
</span><span class="comment">*</span><span class="comment">  conjugate transpose of Z.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  This decomposition is the preprocessing step for computing the
</span><span class="comment">*</span><span class="comment">  Generalized Singular Value Decomposition (GSVD), see subroutine
</span><span class="comment">*</span><span class="comment">  <a name="ZGGSVD.47"></a><a href="zggsvd.f.html#ZGGSVD.1">ZGGSVD</a>.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  Arguments
</span><span class="comment">*</span><span class="comment">  =========
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  JOBU    (input) CHARACTER*1
</span><span class="comment">*</span><span class="comment">          = 'U':  Unitary matrix U is computed;
</span><span class="comment">*</span><span class="comment">          = 'N':  U is not computed.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  JOBV    (input) CHARACTER*1
</span><span class="comment">*</span><span class="comment">          = 'V':  Unitary matrix V is computed;
</span><span class="comment">*</span><span class="comment">          = 'N':  V is not computed.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  JOBQ    (input) CHARACTER*1
</span><span class="comment">*</span><span class="comment">          = 'Q':  Unitary matrix Q is computed;
</span><span class="comment">*</span><span class="comment">          = 'N':  Q is not computed.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  M       (input) INTEGER
</span><span class="comment">*</span><span class="comment">          The number of rows of the matrix A.  M &gt;= 0.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  P       (input) INTEGER
</span><span class="comment">*</span><span class="comment">          The number of rows of the matrix B.  P &gt;= 0.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  N       (input) INTEGER
</span><span class="comment">*</span><span class="comment">          The number of columns of the matrices A and B.  N &gt;= 0.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  A       (input/output) COMPLEX*16 array, dimension (LDA,N)
</span><span class="comment">*</span><span class="comment">          On entry, the M-by-N matrix A.
</span><span class="comment">*</span><span class="comment">          On exit, A contains the triangular (or trapezoidal) matrix
</span><span class="comment">*</span><span class="comment">          described in the Purpose section.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  LDA     (input) INTEGER
</span><span class="comment">*</span><span class="comment">          The leading dimension of the array A. LDA &gt;= max(1,M).
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  B       (input/output) COMPLEX*16 array, dimension (LDB,N)
</span><span class="comment">*</span><span class="comment">          On entry, the P-by-N matrix B.
</span><span class="comment">*</span><span class="comment">          On exit, B contains the triangular matrix described in
</span><span class="comment">*</span><span class="comment">          the Purpose section.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  LDB     (input) INTEGER
</span><span class="comment">*</span><span class="comment">          The leading dimension of the array B. LDB &gt;= max(1,P).
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  TOLA    (input) DOUBLE PRECISION
</span><span class="comment">*</span><span class="comment">  TOLB    (input) DOUBLE PRECISION
</span><span class="comment">*</span><span class="comment">          TOLA and TOLB are the thresholds to determine the effective
</span><span class="comment">*</span><span class="comment">          numerical rank of matrix B and a subblock of A. Generally,
</span><span class="comment">*</span><span class="comment">          they are set to
</span><span class="comment">*</span><span class="comment">             TOLA = MAX(M,N)*norm(A)*MAZHEPS,
</span><span class="comment">*</span><span class="comment">             TOLB = MAX(P,N)*norm(B)*MAZHEPS.
</span><span class="comment">*</span><span class="comment">          The size of TOLA and TOLB may affect the size of backward
</span><span class="comment">*</span><span class="comment">          errors of the decomposition.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  K       (output) INTEGER
</span><span class="comment">*</span><span class="comment">  L       (output) INTEGER
</span><span class="comment">*</span><span class="comment">          On exit, K and L specify the dimension of the subblocks
</span><span class="comment">*</span><span class="comment">          described in Purpose section.
</span><span class="comment">*</span><span class="comment">          K + L = effective numerical rank of (A',B')'.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  U       (output) COMPLEX*16 array, dimension (LDU,M)
</span><span class="comment">*</span><span class="comment">          If JOBU = 'U', U contains the unitary matrix U.
</span><span class="comment">*</span><span class="comment">          If JOBU = 'N', U is not referenced.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  LDU     (input) INTEGER
</span><span class="comment">*</span><span class="comment">          The leading dimension of the array U. LDU &gt;= max(1,M) if
</span><span class="comment">*</span><span class="comment">          JOBU = 'U'; LDU &gt;= 1 otherwise.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  V       (output) COMPLEX*16 array, dimension (LDV,M)
</span><span class="comment">*</span><span class="comment">          If JOBV = 'V', V contains the unitary matrix V.
</span><span class="comment">*</span><span class="comment">          If JOBV = 'N', V is not referenced.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  LDV     (input) INTEGER
</span><span class="comment">*</span><span class="comment">          The leading dimension of the array V. LDV &gt;= max(1,P) if
</span><span class="comment">*</span><span class="comment">          JOBV = 'V'; LDV &gt;= 1 otherwise.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  Q       (output) COMPLEX*16 array, dimension (LDQ,N)
</span><span class="comment">*</span><span class="comment">          If JOBQ = 'Q', Q contains the unitary matrix Q.
</span><span class="comment">*</span><span class="comment">          If JOBQ = 'N', Q is not referenced.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  LDQ     (input) INTEGER
</span><span class="comment">*</span><span class="comment">          The leading dimension of the array Q. LDQ &gt;= max(1,N) if
</span><span class="comment">*</span><span class="comment">          JOBQ = 'Q'; LDQ &gt;= 1 otherwise.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  IWORK   (workspace) INTEGER array, dimension (N)
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  RWORK   (workspace) DOUBLE PRECISION array, dimension (2*N)
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  TAU     (workspace) COMPLEX*16 array, dimension (N)
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  WORK    (workspace) COMPLEX*16 array, dimension (max(3*N,M,P))
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  INFO    (output) INTEGER
</span><span class="comment">*</span><span class="comment">          = 0:  successful exit
</span><span class="comment">*</span><span class="comment">          &lt; 0:  if INFO = -i, the i-th argument had an illegal value.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  Further Details
</span><span class="comment">*</span><span class="comment">  ===============
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  The subroutine uses LAPACK subroutine <a name="ZGEQPF.144"></a><a href="zgeqpf.f.html#ZGEQPF.1">ZGEQPF</a> for the QR factorization
</span><span class="comment">*</span><span class="comment">  with column pivoting to detect the effective numerical rank of the
</span><span class="comment">*</span><span class="comment">  a matrix. It may be replaced by a better rank determination strategy.
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">  =====================================================================
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     .. Parameters ..
</span>      COMPLEX*16         CZERO, CONE
      PARAMETER          ( CZERO = ( 0.0D+0, 0.0D+0 ),
     $                   CONE = ( 1.0D+0, 0.0D+0 ) )
<span class="comment">*</span><span class="comment">     ..
</span><span class="comment">*</span><span class="comment">     .. Local Scalars ..
</span>      LOGICAL            FORWRD, WANTQ, WANTU, WANTV
      INTEGER            I, J
      COMPLEX*16         T
<span class="comment">*</span><span class="comment">     ..
</span><span class="comment">*</span><span class="comment">     .. External Functions ..
</span>      LOGICAL            <a name="LSAME.161"></a><a href="lsame.f.html#LSAME.1">LSAME</a>
      EXTERNAL           <a name="LSAME.162"></a><a href="lsame.f.html#LSAME.1">LSAME</a>
<span class="comment">*</span><span class="comment">     ..
</span><span class="comment">*</span><span class="comment">     .. External Subroutines ..
</span>      EXTERNAL           <a name="XERBLA.165"></a><a href="xerbla.f.html#XERBLA.1">XERBLA</a>, <a name="ZGEQPF.165"></a><a href="zgeqpf.f.html#ZGEQPF.1">ZGEQPF</a>, <a name="ZGEQR2.165"></a><a href="zgeqr2.f.html#ZGEQR2.1">ZGEQR2</a>, <a name="ZGERQ2.165"></a><a href="zgerq2.f.html#ZGERQ2.1">ZGERQ2</a>, <a name="ZLACPY.165"></a><a href="zlacpy.f.html#ZLACPY.1">ZLACPY</a>, <a name="ZLAPMT.165"></a><a href="zlapmt.f.html#ZLAPMT.1">ZLAPMT</a>,
     $                   <a name="ZLASET.166"></a><a href="zlaset.f.html#ZLASET.1">ZLASET</a>, <a name="ZUNG2R.166"></a><a href="zung2r.f.html#ZUNG2R.1">ZUNG2R</a>, <a name="ZUNM2R.166"></a><a href="zunm2r.f.html#ZUNM2R.1">ZUNM2R</a>, <a name="ZUNMR2.166"></a><a href="zunmr2.f.html#ZUNMR2.1">ZUNMR2</a>
<span class="comment">*</span><span class="comment">     ..
</span><span class="comment">*</span><span class="comment">     .. Intrinsic Functions ..
</span>      INTRINSIC          ABS, DBLE, DIMAG, MAX, MIN
<span class="comment">*</span><span class="comment">     ..
</span><span class="comment">*</span><span class="comment">     .. Statement Functions ..
</span>      DOUBLE PRECISION   CABS1
<span class="comment">*</span><span class="comment">     ..
</span><span class="comment">*</span><span class="comment">     .. Statement Function definitions ..
</span>      CABS1( T ) = ABS( DBLE( T ) ) + ABS( DIMAG( T ) )
<span class="comment">*</span><span class="comment">     ..
</span><span class="comment">*</span><span class="comment">     .. Executable Statements ..
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     Test the input parameters
</span><span class="comment">*</span><span class="comment">
</span>      WANTU = <a name="LSAME.181"></a><a href="lsame.f.html#LSAME.1">LSAME</a>( JOBU, <span class="string">'U'</span> )
      WANTV = <a name="LSAME.182"></a><a href="lsame.f.html#LSAME.1">LSAME</a>( JOBV, <span class="string">'V'</span> )
      WANTQ = <a name="LSAME.183"></a><a href="lsame.f.html#LSAME.1">LSAME</a>( JOBQ, <span class="string">'Q'</span> )
      FORWRD = .TRUE.
<span class="comment">*</span><span class="comment">
</span>      INFO = 0
      IF( .NOT.( WANTU .OR. <a name="LSAME.187"></a><a href="lsame.f.html#LSAME.1">LSAME</a>( JOBU, <span class="string">'N'</span> ) ) ) THEN
         INFO = -1
      ELSE IF( .NOT.( WANTV .OR. <a name="LSAME.189"></a><a href="lsame.f.html#LSAME.1">LSAME</a>( JOBV, <span class="string">'N'</span> ) ) ) THEN
         INFO = -2
      ELSE IF( .NOT.( WANTQ .OR. <a name="LSAME.191"></a><a href="lsame.f.html#LSAME.1">LSAME</a>( JOBQ, <span class="string">'N'</span> ) ) ) THEN
         INFO = -3
      ELSE IF( M.LT.0 ) THEN
         INFO = -4
      ELSE IF( P.LT.0 ) THEN
         INFO = -5
      ELSE IF( N.LT.0 ) THEN
         INFO = -6
      ELSE IF( LDA.LT.MAX( 1, M ) ) THEN
         INFO = -8
      ELSE IF( LDB.LT.MAX( 1, P ) ) THEN
         INFO = -10
      ELSE IF( LDU.LT.1 .OR. ( WANTU .AND. LDU.LT.M ) ) THEN
         INFO = -16
      ELSE IF( LDV.LT.1 .OR. ( WANTV .AND. LDV.LT.P ) ) THEN
         INFO = -18
      ELSE IF( LDQ.LT.1 .OR. ( WANTQ .AND. LDQ.LT.N ) ) THEN
         INFO = -20
      END IF
      IF( INFO.NE.0 ) THEN
         CALL <a name="XERBLA.211"></a><a href="xerbla.f.html#XERBLA.1">XERBLA</a>( <span class="string">'<a name="ZGGSVP.211"></a><a href="zggsvp.f.html#ZGGSVP.1">ZGGSVP</a>'</span>, -INFO )
         RETURN
      END IF
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     QR with column pivoting of B: B*P = V*( S11 S12 )
</span><span class="comment">*</span><span class="comment">                                           (  0   0  )
</span><span class="comment">*</span><span class="comment">
</span>      DO 10 I = 1, N
         IWORK( I ) = 0
   10 CONTINUE
      CALL <a name="ZGEQPF.221"></a><a href="zgeqpf.f.html#ZGEQPF.1">ZGEQPF</a>( P, N, B, LDB, IWORK, TAU, WORK, RWORK, INFO )
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     Update A := A*P
</span><span class="comment">*</span><span class="comment">
</span>      CALL <a name="ZLAPMT.225"></a><a href="zlapmt.f.html#ZLAPMT.1">ZLAPMT</a>( FORWRD, M, N, A, LDA, IWORK )
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     Determine the effective rank of matrix B.
</span><span class="comment">*</span><span class="comment">
</span>      L = 0
      DO 20 I = 1, MIN( P, N )
         IF( CABS1( B( I, I ) ).GT.TOLB )
     $      L = L + 1
   20 CONTINUE
<span class="comment">*</span><span class="comment">
</span>      IF( WANTV ) THEN
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">        Copy the details of V, and form V.
</span><span class="comment">*</span><span class="comment">
</span>         CALL <a name="ZLASET.239"></a><a href="zlaset.f.html#ZLASET.1">ZLASET</a>( <span class="string">'Full'</span>, P, P, CZERO, CZERO, V, LDV )
         IF( P.GT.1 )
     $      CALL <a name="ZLACPY.241"></a><a href="zlacpy.f.html#ZLACPY.1">ZLACPY</a>( <span class="string">'Lower'</span>, P-1, N, B( 2, 1 ), LDB, V( 2, 1 ),
     $                   LDV )
         CALL <a name="ZUNG2R.243"></a><a href="zung2r.f.html#ZUNG2R.1">ZUNG2R</a>( P, P, MIN( P, N ), V, LDV, TAU, WORK, INFO )
      END IF
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     Clean up B
</span><span class="comment">*</span><span class="comment">
</span>      DO 40 J = 1, L - 1
         DO 30 I = J + 1, L
            B( I, J ) = CZERO
   30    CONTINUE
   40 CONTINUE
      IF( P.GT.L )
     $   CALL <a name="ZLASET.254"></a><a href="zlaset.f.html#ZLASET.1">ZLASET</a>( <span class="string">'Full'</span>, P-L, N, CZERO, CZERO, B( L+1, 1 ), LDB )
<span class="comment">*</span><span class="comment">
</span>      IF( WANTQ ) THEN
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">        Set Q = I and Update Q := Q*P
</span><span class="comment">*</span><span class="comment">
</span>         CALL <a name="ZLASET.260"></a><a href="zlaset.f.html#ZLASET.1">ZLASET</a>( <span class="string">'Full'</span>, N, N, CZERO, CONE, Q, LDQ )
         CALL <a name="ZLAPMT.261"></a><a href="zlapmt.f.html#ZLAPMT.1">ZLAPMT</a>( FORWRD, N, N, Q, LDQ, IWORK )
      END IF
<span class="comment">*</span><span class="comment">
</span>      IF( P.GE.L .AND. N.NE.L ) THEN
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">        RQ factorization of ( S11 S12 ) = ( 0 S12 )*Z
</span><span class="comment">*</span><span class="comment">
</span>         CALL <a name="ZGERQ2.268"></a><a href="zgerq2.f.html#ZGERQ2.1">ZGERQ2</a>( L, N, B, LDB, TAU, WORK, INFO )
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">        Update A := A*Z'
</span><span class="comment">*</span><span class="comment">
</span>         CALL <a name="ZUNMR2.272"></a><a href="zunmr2.f.html#ZUNMR2.1">ZUNMR2</a>( <span class="string">'Right'</span>, <span class="string">'Conjugate transpose'</span>, M, N, L, B, LDB,
     $                TAU, A, LDA, WORK, INFO )
         IF( WANTQ ) THEN
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">           Update Q := Q*Z'
</span><span class="comment">*</span><span class="comment">
</span>            CALL <a name="ZUNMR2.278"></a><a href="zunmr2.f.html#ZUNMR2.1">ZUNMR2</a>( <span class="string">'Right'</span>, <span class="string">'Conjugate transpose'</span>, N, N, L, B,
     $                   LDB, TAU, Q, LDQ, WORK, INFO )
         END IF
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">        Clean up B
</span><span class="comment">*</span><span class="comment">
</span>         CALL <a name="ZLASET.284"></a><a href="zlaset.f.html#ZLASET.1">ZLASET</a>( <span class="string">'Full'</span>, L, N-L, CZERO, CZERO, B, LDB )
         DO 60 J = N - L + 1, N
            DO 50 I = J - N + L + 1, L
               B( I, J ) = CZERO
   50       CONTINUE
   60    CONTINUE
<span class="comment">*</span><span class="comment">
</span>      END IF
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     Let              N-L     L
</span><span class="comment">*</span><span class="comment">                A = ( A11    A12 ) M,
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     then the following does the complete QR decomposition of A11:
</span><span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">              A11 = U*(  0  T12 )*P1'
</span><span class="comment">*</span><span class="comment">                      (  0   0  )
</span><span class="comment">*</span><span class="comment">
</span>      DO 70 I = 1, N - L
         IWORK( I ) = 0
   70 CONTINUE
      CALL <a name="ZGEQPF.304"></a><a href="zgeqpf.f.html#ZGEQPF.1">ZGEQPF</a>( M, N-L, A, LDA, IWORK, TAU, WORK, RWORK, INFO )
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     Determine the effective rank of A11
</span><span class="comment">*</span><span class="comment">
</span>      K = 0
      DO 80 I = 1, MIN( M, N-L )
         IF( CABS1( A( I, I ) ).GT.TOLA )
     $      K = K + 1
   80 CONTINUE
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     Update A12 := U'*A12, where A12 = A( 1:M, N-L+1:N )
</span><span class="comment">*</span><span class="comment">
</span>      CALL <a name="ZUNM2R.316"></a><a href="zunm2r.f.html#ZUNM2R.1">ZUNM2R</a>( <span class="string">'Left'</span>, <span class="string">'Conjugate transpose'</span>, M, L, MIN( M, N-L ),
     $             A, LDA, TAU, A( 1, N-L+1 ), LDA, WORK, INFO )
<span class="comment">*</span><span class="comment">
</span>      IF( WANTU ) THEN
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">        Copy the details of U, and form U
</span><span class="comment">*</span><span class="comment">
</span>         CALL <a name="ZLASET.323"></a><a href="zlaset.f.html#ZLASET.1">ZLASET</a>( <span class="string">'Full'</span>, M, M, CZERO, CZERO, U, LDU )
         IF( M.GT.1 )
     $      CALL <a name="ZLACPY.325"></a><a href="zlacpy.f.html#ZLACPY.1">ZLACPY</a>( <span class="string">'Lower'</span>, M-1, N-L, A( 2, 1 ), LDA, U( 2, 1 ),
     $                   LDU )
         CALL <a name="ZUNG2R.327"></a><a href="zung2r.f.html#ZUNG2R.1">ZUNG2R</a>( M, M, MIN( M, N-L ), U, LDU, TAU, WORK, INFO )
      END IF
<span class="comment">*</span><span class="comment">
</span>      IF( WANTQ ) THEN
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">        Update Q( 1:N, 1:N-L )  = Q( 1:N, 1:N-L )*P1
</span><span class="comment">*</span><span class="comment">
</span>         CALL <a name="ZLAPMT.334"></a><a href="zlapmt.f.html#ZLAPMT.1">ZLAPMT</a>( FORWRD, N, N-L, Q, LDQ, IWORK )
      END IF
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     Clean up A: set the strictly lower triangular part of
</span><span class="comment">*</span><span class="comment">     A(1:K, 1:K) = 0, and A( K+1:M, 1:N-L ) = 0.
</span><span class="comment">*</span><span class="comment">
</span>      DO 100 J = 1, K - 1
         DO 90 I = J + 1, K
            A( I, J ) = CZERO
   90    CONTINUE
  100 CONTINUE
      IF( M.GT.K )
     $   CALL <a name="ZLASET.346"></a><a href="zlaset.f.html#ZLASET.1">ZLASET</a>( <span class="string">'Full'</span>, M-K, N-L, CZERO, CZERO, A( K+1, 1 ), LDA )
<span class="comment">*</span><span class="comment">
</span>      IF( N-L.GT.K ) THEN
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">        RQ factorization of ( T11 T12 ) = ( 0 T12 )*Z1
</span><span class="comment">*</span><span class="comment">
</span>         CALL <a name="ZGERQ2.352"></a><a href="zgerq2.f.html#ZGERQ2.1">ZGERQ2</a>( K, N-L, A, LDA, TAU, WORK, INFO )
<span class="comment">*</span><span class="comment">
</span>         IF( WANTQ ) THEN
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">           Update Q( 1:N,1:N-L ) = Q( 1:N,1:N-L )*Z1'
</span><span class="comment">*</span><span class="comment">
</span>            CALL <a name="ZUNMR2.358"></a><a href="zunmr2.f.html#ZUNMR2.1">ZUNMR2</a>( <span class="string">'Right'</span>, <span class="string">'Conjugate transpose'</span>, N, N-L, K, A,
     $                   LDA, TAU, Q, LDQ, WORK, INFO )
         END IF
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">        Clean up A
</span><span class="comment">*</span><span class="comment">
</span>         CALL <a name="ZLASET.364"></a><a href="zlaset.f.html#ZLASET.1">ZLASET</a>( <span class="string">'Full'</span>, K, N-L-K, CZERO, CZERO, A, LDA )
         DO 120 J = N - L - K + 1, N - L
            DO 110 I = J - N + L + K + 1, K
               A( I, J ) = CZERO
  110       CONTINUE
  120    CONTINUE
<span class="comment">*</span><span class="comment">
</span>      END IF
<span class="comment">*</span><span class="comment">
</span>      IF( M.GT.K ) THEN
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">        QR factorization of A( K+1:M,N-L+1:N )
</span><span class="comment">*</span><span class="comment">
</span>         CALL <a name="ZGEQR2.377"></a><a href="zgeqr2.f.html#ZGEQR2.1">ZGEQR2</a>( M-K, L, A( K+1, N-L+1 ), LDA, TAU, WORK, INFO )
<span class="comment">*</span><span class="comment">
</span>         IF( WANTU ) THEN
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">           Update U(:,K+1:M) := U(:,K+1:M)*U1
</span><span class="comment">*</span><span class="comment">
</span>            CALL <a name="ZUNM2R.383"></a><a href="zunm2r.f.html#ZUNM2R.1">ZUNM2R</a>( <span class="string">'Right'</span>, <span class="string">'No transpose'</span>, M, M-K, MIN( M-K, L ),
     $                   A( K+1, N-L+1 ), LDA, TAU, U( 1, K+1 ), LDU,
     $                   WORK, INFO )
         END IF
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">        Clean up
</span><span class="comment">*</span><span class="comment">
</span>         DO 140 J = N - L + 1, N
            DO 130 I = J - N + K + L + 1, M
               A( I, J ) = CZERO
  130       CONTINUE
  140    CONTINUE
<span class="comment">*</span><span class="comment">
</span>      END IF
<span class="comment">*</span><span class="comment">
</span>      RETURN
<span class="comment">*</span><span class="comment">
</span><span class="comment">*</span><span class="comment">     End of <a name="ZGGSVP.400"></a><a href="zggsvp.f.html#ZGGSVP.1">ZGGSVP</a>
</span><span class="comment">*</span><span class="comment">
</span>      END

</pre>

 </body>
</html>
