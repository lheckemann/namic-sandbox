PROJECT( OpenIGTLink )

#
# Platforms
#

IF(CMAKE_SYSTEM_NAME STREQUAL "Darwin")
  ADD_DEFINITIONS(
    -DIGTL_USE_PTHREADS
    -DPLATFORM_OSX_LEOPARD
    )
ENDIF(CMAKE_SYSTEM_NAME STREQUAL "Darwin")

IF(CMAKE_SYSTEM_NAME MATCHES Linux)
  ADD_DEFINITIONS(
    -DPLATFORM_LINUX
    -DIGTL_USE_PTHREADS
    )
  SET(LINUX 1)
ENDIF(CMAKE_SYSTEM_NAME MATCHES Linux)

IF(CMAKE_SYSTEM_NAME STREQUAL "Windows")
  ADD_DEFINITIONS(
    -DPLATFORM_WIN32
    -D_WIN32
    -DIGTLCommon_EXPORTS
    -DIGTL_USE_WIN32_THREADS
    )
    SET(WIN32 1)
ENDIF(CMAKE_SYSTEM_NAME STREQUAL "Windows")

#
# TYPE SIZES
#

INCLUDE (CheckTypeSize)
CHECK_TYPE_SIZE(int         CMAKE_SIZEOF_INT)
CHECK_TYPE_SIZE(long        CMAKE_SIZEOF_LONG)
CHECK_TYPE_SIZE("void*"     CMAKE_SIZEOF_VOID_P)
CHECK_TYPE_SIZE(char        CMAKE_SIZEOF_CHAR)
CHECK_TYPE_SIZE(short       CMAKE_SIZEOF_SHORT)
CHECK_TYPE_SIZE(float       CMAKE_SIZEOF_FLOAT)
CHECK_TYPE_SIZE(double      CMAKE_SIZEOF_DOUBLE)
CHECK_TYPE_SIZE("long long" CMAKE_SIZEOF_LONG_LONG)
CHECK_TYPE_SIZE("__int64"   CMAKE_SIZEOF___INT64)
CHECK_TYPE_SIZE("int64_t"   CMAKE_SIZEOF_INT64_T)

ADD_DEFINITIONS(-DIGTL_SIZEOF_CHAR=${CMAKE_SIZEOF_CHAR})
ADD_DEFINITIONS(-DIGTL_SIZEOF_DOUBLE=${CMAKE_SIZEOF_DOUBLE})
ADD_DEFINITIONS(-DIGTL_SIZEOF_FLOAT=${CMAKE_SIZEOF_FLOAT})
ADD_DEFINITIONS(-DIGTL_SIZEOF_INT=${CMAKE_SIZEOF_INT})
ADD_DEFINITIONS(-DIGTL_SIZEOF_LONG=${CMAKE_SIZEOF_LONG})
ADD_DEFINITIONS(-DIGTL_SIZEOF_SHORT=${CMAKE_SIZEOF_SHORT})
ADD_DEFINITIONS(-DIGTL_SIZEOF_FLOAT=${CMAKE_SIZEOF_FLOAT})
ADD_DEFINITIONS(-DIGTL_SIZEOF_DOUBLE=${CMAKE_SIZEOF_DOUBLE})

IF(CMAKE_SIZEOF_LONG_LONG)
  ADD_DEFINITIONS(-DIGTL_TYPE_USE_LONG_LONG=1)
  ADD_DEFINITIONS(-DIGTL_SIZEOF_LONG_LONG=${CMAKE_SIZEOF_LONG_LONG})
ELSE(CMAKE_SIZEOF_LONG_LONG)
IF(CMAKE_SIZEOF___INT64)
  ADD_DEFINITIONS(-DIGTL_TYPE_USE___INT64=1)
  ADD_DEFINITIONS(-DIGTL_SIZEOF___INT64=${CMAKE_SIZEOF___INT64})
ELSE(CMAKE_SIZEOF___INT64)
IF(CMAKE_SIZEOF_INT64_T)
  ADD_DEFINITIONS(-DIGTL_TYPE_USE_INT64_T=1)
  ADD_DEFINITIONS(-DIGTL_SIZEOF_INT64_T=${CMAKE_SIZEOF_INT64_T})
ENDIF(CMAKE_SIZEOF_INT64_T)
ENDIF(CMAKE_SIZEOF___INT64)
ENDIF(CMAKE_SIZEOF_LONG_LONG)

SET(OpenIGTLink_SOURCES
  igtlClientSocket.cxx
  igtlConditionVariable.cxx
  igtlFastMutexLock.cxx
  igtlImageMessage.cxx
  igtlLightObject.cxx
  igtlMath.cxx
  igtlMessageBase.cxx
  igtlMultiThreader.cxx
  igtlMutexLock.cxx
  igtlOSUtil.cxx
  igtlObject.cxx
  igtlObjectFactoryBase.cxx
  igtlServerSocket.cxx
  igtlSimpleFastMutexLock.cxx
  igtlSocket.cxx
  igtlTransformMessage.cxx
  igtlTimeStamp.cxx
  )

INCLUDE_DIRECTORIES(
  ${CMAKE_CURRENT_SOURCE_DIR}/igtlutil
)

ADD_SUBDIRECTORY( igtlutil )

ADD_LIBRARY(OpenIGTLink STATIC
  ${OpenIGTLink_SOURCES}
  )

TARGET_LINK_LIBRARIES(OpenIGTLink
  igtlutil      
  )
